<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SHOEZO - User Management</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


  <style>

    body {
      font-family: 'Inter', sans-serif;
      background-color: #f1f5f9;
      overflow-x: hidden;
    }

    /* FIX LAYOUT (Sidebar + Navbar height) */
    .main-wrapper {
      margin-left: 240px;      /* Sidebar width */
      margin-top: 70px;        /* Navbar height */
      padding: 30px;
      min-height: calc(100vh - 70px);
    }

    .page-title {
      font-size: 2.2rem;
      font-weight: 800;
      color: #1e293b;
      margin-bottom: 25px;
    }

    /* Search input */
    .search-input {
      height: 56px;
      border-radius: 1rem;
      padding: 0 1.5rem;
      font-size: 1rem;
      border: 1px solid #d1d5db;
      max-width: 450px;
    }

    /* Button */
    .btn-add-user {
      background-color: #010714;
      color: white;
      border-radius: 1rem;
      padding: 0.75rem 2rem;
      font-weight: 600;
      font-size: 1rem;
    }

    .table-card {
      border-radius: 1.3rem;
      overflow: hidden;
      box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1);
      background: white;
    }

    .table thead {
      background-color: #010714;
      color: white;
    }

    .btn-action {
      padding: 0.5rem 1.2rem;
      border-radius: 0.75rem;
      font-weight: 500;
    }

    /* Pagination bottom only */
    .pagination-wrapper {
      margin-top: 25px;
    }

    .page-item.active .page-link {
      background-color: #010714;
      border-color: #010714;
      color: white;
    }

  </style>

</head>

<body>

  <!-- NAVBAR -->
  <%- include("../../views/partials/admin/navbar.ejs") %>

  <!-- SIDEBAR -->
  <%- include("../../views/partials/admin/sidebar.ejs") %>

  <!-- MAIN CONTENT -->
  <div class="main-wrapper">

    <!-- Title -->
    <h1 class="page-title">User Management</h1>

    <!-- Search + Add User -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4 gap-4">
     <form method="GET" action="/admin/customers" class="d-flex gap-3">
  <input
    type="text"
    name="search"
    value="<%= search %>"
    class="form-control search-input"
    placeholder="Search by name or email..."
  >
  <input type="hidden" name="page" value="1">
</form>


      <a href="/admin/add-user" class="btn btn-add-user d-flex align-items-center gap-2">
        <i class="fas fa-plus"></i>
        <span>Add User</span>
      </a>
    </div>

    <!-- TABLE -->
    <div class="table-card">
      <div class="table-responsive">
        <table class="table table-hover mb-0 align-middle">
          <thead>
            <tr>
              <th>S.No</th>
              <th>Name</th>
              <th>Email</th>
              <th>Mobile</th>
              <th class="text-center">Status</th>
            </tr>
          </thead>
          <tbody id="userTableBody">

            <% if (customers.length > 0) { %>
              <% customers.forEach((user, index) => { %>
                <tr>
                  <td><%= index + 1 %></td>
                  <td><%= user.name %></td>
                  <td><%= user.email %></td>
                  <td><%= user.phone || 'â€”' %></td>
                  <td class="text-center">
                    <% if (!user.isBlocked) { %>

                     <button class="btn btn-danger btn-action block-btn"
                  data-link="/admin/blockcustomer?id=<%= user._id %>">
                Block
                     </button>

                      
                      
                    <% } else { %>
                       
                     <button class="btn btn-success btn-action unblock-btn"
                   data-link="/admin/unblockcustomer?id=<%= user._id %>">
                Unblock
                </button>


                      
                    <% } %>
                  </td>
                </tr>
              <% }) %>
            <% } else { %>
              <tr>
                <td colspan="5" class="text-center py-4 text-muted">No users found</td>
              </tr>
            <% } %>

          </tbody>
        </table>
      </div>
    </div>

    <!-- PAGINATION (BOTTOM ONLY) -->
    <div class="pagination-wrapper d-flex justify-content-center">
      <nav>
        <ul class="pagination gap-2">
          <li class="page-item <%= currentPage == 1 ? 'disabled' : '' %>">
            <a class="page-link" href="?page=<%= currentPage - 1 %>&search=<%= search %>">
              <i class="fas fa-chevron-left"></i>
            </a>
          </li>

          <% for (let i = 1; i <= totalPages; i++) { %>
            <li class="page-item <%= currentPage == i ? 'active' : '' %>">
              <a class="page-link" href="?page=<%= i %>&search=<%= search %>"><%= i %></a>
            </li>
          <% } %>

          <li class="page-item <%= currentPage == totalPages ? 'disabled' : '' %>">
            <a class="page-link" href="?page=<%= currentPage + 1 %>&search=<%= search %>">
              <i class="fas fa-chevron-right"></i>
            </a>
          </li>
        </ul>
      </nav>
    </div>

  </div>

  <script>
   // Block and Ublock
   
   document.addEventListener("DOMContentLoaded",()=>{

    //  Blocking user confirmation
    document.querySelectorAll(".block-btn").forEach(btn=>{
      btn.addEventListener("click",function(){
        const url = this.dataset.link;


        Swal.fire({
           title:"Are you sure ?",
           text:"Do you want to BLOCK  this user ?",
           icon:"warning",
           showCancelButton:true,
           ConfirmButtonText:"Yes Block",
           cancelButtonText:"Cancel"

        })
        .then((result)=>{
          if(result.isConfirmed){
            window.location.href = url;
          }
        })

      })
    })
   })

    //  Unblock User Confirmation

    document.querySelectorAll(".unblock-btn").forEach(btn=>{
      btn.addEventListener("click",function(){
        const url = this.dataset.link;

        Swal.fire({
           title:"Are you sure? ",
            text:"Do you want to Unblock this user?",
              icon:"question",
              ConfirmButtonText:"Yes, Unblock",
              cancelButtonText:"Cancel"
           })
          .then((result)=>{
            if(result.isConfirmed){
              window.location.href = url
            }
          })


      })
    })






    
      let filter = this.value.toLowerCase();
      let rows = document.querySelectorAll("#userTableBody tr");

      rows.forEach(row => {
        let name = row.cells[1]?.textContent.toLowerCase() || "";
        let email = row.cells[2]?.textContent.toLowerCase() || "";
        let mobile = row.cells[3]?.textContent.toLowerCase() || "";

        row.style.display = (name.includes(filter) || email.includes(filter) || mobile.includes(filter))
          ? ""
          : "none";
      });
    
  </script>

</body>
</html>
